# 요구사항 요약

## 추가 1
- (삭제)
- 노드를 선택하면 모달 뷰어는 이미지가 아닌 폴더 'videos' 내의 영상을 재생.

## 추가 2 — 비디오 스크럽 기반 인터랙션
- 각 노드에 연결된 영상은 약 5초 길이로 제공되며, 팝업이 열리면 자동 재생이 아닌 **사용자 스크롤**에 따라 `currentTime`이 이동해야 합니다.
- `enableScrollPlayback`이 팝업 오픈 시 `scrollGhost`를 1,600px 이상으로 확장하고 wheel/touch 이벤트를 가로채 `updateVirtualScroll`에 전달함으로써, 실스크롤을 잠근 상태에서도 가상 스크롤 포지션(`virtualScrollPos`)을 제어합니다.
- `applyVirtualScroll`이 가상 스크롤 진행도를 0~1 비율로 정규화한 뒤 영상 길이에 매핑하고, `requestAnimationFrame` 기반 루프로 과도한 갱신을 억제합니다. 창 크기가 바뀌면 `refreshVirtualScrollBounds`가 범위를 재계산합니다.
- 팝업이 닫히면 `disableScrollPlayback`과 `resetMediaState`가 이벤트 리스너, 비디오 소스, 가상 스크롤 상태를 해제해 리소스 누수와 의도치 않은 시간 이동을 방지합니다.

## 추가 3 — 핫스팟 기반 게임 시스템
- 노드 데이터에는 `hotspots` 배열을 정의하여, `timeRange`(초 단위)와 정규화 좌표(`x`,`y`,`w`,`h`)로 표현된 클릭 영역을 선언합니다.
- `updateHotspotsVisibility`가 현재 `currentTime`이 범위 안에 있는 항목만 DOM에 추가하고, 가시 Hotspot이 존재할 때에만 포인터 이벤트를 허용합니다.
- 핫스팟을 클릭하면 `openInteractiveNode`가 `ensureNode`/`ensureLinkBetween`을 통해 대상 노드를 생성·연결한 뒤 팝업을 연계하여 분기 탐험을 이어갑니다.
- 새로 생성된 노드는 `refreshGraph` 재호출을 통해 D3 데이터 조인에 합류하고, 시뮬레이션이 `alpha`를 높여 즉시 업데이트됩니다.

## 추가 4 — 핫스팟 인스펙터 지원
- 제작 중에는 단축키 기반 “핫스팟 인스펙터”를 제공하여 팝업 내부에서 드래그 박스를 그리면 정규화 좌표와 권장 `timeRange` 템플릿을 콘솔 및 클립보드로 출력하도록 합니다.
- 인스펙터는 `I` 토글, `[`, `]` 프레임 스텝 이동(Shift 시 ±0.2초 가속)과 같은 키바인딩을 제공하며, 배포 시에는 기본 비활성화 상태를 유지합니다.
- Inspector 모드에서는 `hotspotLayer`가 디버그 스타일(`hotspot--debug`)을 적용하고, 드래그 중 임시 박스(`hotspot--draft`)를 렌더링합니다.
- 추출된 JSON은 콘솔 로그와 `navigator.clipboard.writeText`를 통해 동시에 복사되어 데이터 입력을 가속합니다.

## 추가 5 — 장식용 더미 노드
- 장식 목적의 노드는 데이터 모델에 `decorative: true` 플래그로 명시하며, `video`와 `hotspots` 속성은 정의하지 않습니다.
- 기본 스타일 가이드는 `appearance.opacity`를 통해 투명하게 표현하고, 시뮬레이션에는 포함되지만 상호작용 대상에서는 제외합니다.
- 기본 노드 반지름 대비 약 0.8배(4.8px vs 6px)를 적용해 본편 노드보다 작게 보이도록 하며, 필요 시 `appearance` 값으로 불투명도를 조절합니다.
- 렌더링 시 `.node--decorative` 클래스를 사용해 포인터 이벤트를 차단하고, 포커스 가능 요소 목록에서도 제외하여 팝업이 열리지 않도록 합니다.
- 라벨과 HUD 요소는 기본적으로 숨기되, 필요 시 별도의 `appearance` 설정으로 재정의할 수 있도록 합니다.

## 추가 6 — 스크롤 속도 기반 오디오·하프틱 피드백
- `audios/tick.wav`(또는 동등한 단일 샘플)을 사운드 피드백의 공통 자산으로 사용해 스크롤 스크럽과 클릭 인터랙션 모두에서 동일한 “틱” 감각을 제공합니다.
- 스크롤 이벤트 처리 시 최근 스크롤 거리와 시간을 기준으로 최소 재생 간격(스크롤 90ms, 클릭 60ms)과 임계 스크롤 이동량(±2px)을 만족할 때마다 효과음을 재생하고, 스크롤 속도에 따라 `playbackRate`를 0.8~1.3 범위로 매핑합니다.
- 모바일 기기에서는 `navigator.vibrate(10)`으로 짧은 진동을 함께 트리거하되, 지원하지 않는 환경에서는 조용히 무시합니다.
- 클릭 이벤트(핫스팟, 노드 등 사용자 액션 피드백)는 동일한 `tick.wav`를 공유하며, 버퍼가 준비되지 않은 경우에는 프라미스 기반 로딩으로 보강합니다.
- 브라우저 오토플레이 정책을 준수하기 위해 최초 사용자 제스처가 발생한 이후에만 오디오 컨텍스트를 활성화하고, 재생 실패 시 graceful fallback 메시지를 로그로 남깁니다.

## 추가 7 — 링크 생성 흐름 리셋
- 초기 로드시 `links` 배열은 비어 있거나 시각적으로 숨겨진 상태에서 시작하며, 모든 노드는 “고립된” 점으로 표현됩니다.
- 사용자가 핫스팟을 클릭하거나 게임 내 지정 액션을 수행할 때마다 현재 노드와 대상 노드 사이에 링크를 생성하고, 해당 링크는 즉시 force 시뮬레이션과 배경/전경 레이어에 반영됩니다.
- `ensureLinkBetween`이 ID 쌍을 기준으로 중복 생성을 차단하고, `refreshGraph`가 호출되며 `simulation.alpha(0.7).restart()`로 시뮬레이션을 재가열합니다.
- 장식용 노드는 링크 대상에서 제외되며, 플레이어 진행도에는 영향을 주지 않습니다.

## 추가 8 — 완전 연결 축하 이벤트
- “완전 연결” 상태는 상호작용 가능한 노드들이 단일 연결 요소를 이루어 어떤 노드도 고립되지 않은 순간으로 정의하며, 장식용 노드는 조건 계산에서 제외합니다. 또한 모든 인터랙티브 노드를 최소 한 번씩 열어보았을 때에만 축하 조건이 유효합니다.
- 조건을 최초로 만족할 때(세션당 1회) `startCelebrationSequence`가 일반 팝업을 닫고 `I love you_speech.mp4` 영상을 전체 화면 팝업으로 자동 재생합니다.
- 축하 시퀀스는 그래프 레이아웃을 2단계 애니메이션으로 전환합니다: (1) 1초 동안 노드를 원형 도넛 형태로 재배치, (2) 이어서 하트 곡선 배치로 2초간 부드럽게 인터폴레이션합니다. 두 단계 모두 `requestAnimationFrame` 기반 이징(`easeInOutCubic`)으로 진행됩니다.
- 애니메이션 도중에는 force 시뮬레이션을 일시적으로 중단하고(`pauseSimulationForCelebration`), 완료 후에는 노드를 목표 좌표에 고정했다가 `releaseNodesAfterCelebration`으로 해제하고 `simulation.alpha(0.6).restart()`로 원래 설정을 재가동합니다.
- 축하 팝업에는 재생 제어(닫기, 다시 보기)가 포함되며, 영상 종료 또는 사용자가 닫기 버튼을 누르면 일반 인터랙션 모드로 복귀합니다.

## 추가 9 - 팝업 등장 시 스크롤락
- 팝업이 열린 상태에서는 초기 화면의 스크롤이 락되어 화면보다 큰 크기를 가지고 있다고 하더라도 스크롤에 따라 움직이지 않도록 합니다.
- `lockSceneContainer`가 팝업 또는 축하 모달 오픈 시 장면 컨테이너를 고정하고 `body-scroll-locked` 클래스를 부여해 배경 스크롤을 차단합니다. 닫힐 때는 `unlockSceneContainer`가 이를 해제합니다.

## 추가 10
- 분위기 연출을 위한 엔트리의 `appearance.opacity`를 기본 0.3에서 0.5로, `appearance.scale`을 0.9에서 0.8로 조정합니다.

===
* 이하 내용부터 패치 완료 시, [패치 완료] 표시

## 추가 11 [패치 완료]
- 많은 영상을 넣었음에도 지연 없이 체험이 가능할 수 있는 최적화 구조를 분석 및 계획합니다.

- 초기 로딩에서 모든 영상 소스의 로딩을 거쳐 체험 중에는 로딩이나 idle time이 없도록 합니다.
- 초기 로딩에 로딩 UI를 추가합니다.

- 장식용 더미 노드(`decorative`로 표시된 노드)들은 초기 화면에서부터 기본적으로 각 노드간 연결되어 있습니다. 페르소나 노드에는 연결되지 않습니다.

- 조작된지 1분이 지나면 자동으로 노드 연결 상태 및 달성된 이벤트 조건을 초기화 합니다 - 리셋을 하나, 새로고침 등으로 영상 소스 로딩을 다시 거치지 않습니다.
- 영상 프리로딩 직후와 비활성화 리셋 후 마우스가 다시 움직일 때 HUD 패널 형태의 조작 안내를 우측 하단에 5초간 표시합니다.

- 기존 6개의 노드의 구성을 아래 목록과 같이 20개의 노드로 수정해주세요. 라벨의 이름은 파일명의 단어(예: young evelyn)과 통일합니다.
* 01_young evelyn.mp4
* 02_bagle.mp4
* 03_actor.mp4
* 04_IRS office.mp4
* 05_singer.mp4
* 06_pottery.mp4
* 07_sign spinner.mp4
* 08_cat.mp4
* 09_slaughterhouse.mp4
* 10_tinder.mp4
* 11_macho.mp4
* 12_lab.mp4
* 13_monster.mp4
* 14_animation.mp4
* 15_youtube.mp4
* 16_soldier.mp4
* 17_hotdog fingers.mp4
* 18_jail.mp4
* 19_statue.mp4
* 20_grape.mp4
